<html>

<head>
    <link rel="stylesheet" href="assets/updatePassword.css">
    <script src="assets/updatePassword.js"></script>
</head>

<body>
    <div class="mainDiv">
        <div class="cardStyle">
            <form action="/user/savePassword" method="post" name="signupForm" id="signupForm">

                <img src="https://s3-us-west-2.amazonaws.com/shipsy-public-assets/shipsy/SHIPSY_LOGO_BIRD_BLUE.png"
                    id="signupLogo">
                <h2 class="formTitle">
                    Login to your account
                </h2>

                <div class="inputDiv">
                    <label class="inputLabel" for="password">New Password</label>
                    <input type="password" id="password" name="newPassword" required>
                </div>

                <div class="inputDiv">
                    <label class="inputLabel" for="confirmPassword">Confirm Password</label>
                    <input type="password" id="confirmPassword" name="confirmPassword">
                </div>

                <div class="buttonWrapper">
                    <button type="submit" id="submitButton" onclick="validateSignupForm()"
                        class="submitButton pure-button pure-button-primary">
                        <span>Continue</span>
                        <span id="loader"></span>
                    </button>
                </div>

            </form>
        </div>
    </div>
    <script>
        function validateSignupForm() {
            var form = document.getElementById('signupForm');

            for (var i = 0; i < form.elements.length; i++) {
                if (form.elements[i].value === '' && form.elements[i].hasAttribute('required')) {
                    console.log('There are some required fields!');
                    return false;
                }
            }
        }

    </script>

    <script nonce="randomValue">
        document.addEventListener('DOMContentLoaded', function () {
            function getTokenFromUrl() {
                const params = new URLSearchParams(window.location.search);
                return params.get('token');
            }
            function sendTokenToServer(token) {
                // Get the form element
                const form = document.querySelector('#signupForm');
                if (form) {
                    form.addEventListener('submit', function (event) {
                        event.preventDefault(); // Prevent the default form submission

                        // Get the values from the form inputs
                        const newPassword = document.querySelector('input[name="newPassword"]').value;
                        // Prepare the data for the POST request
                        const requestData = {
                            newPassword: newPassword,
                        };
                        const redirectUrl = encodeURIComponent("hospital");

                        // Send the data to the API   ?redirectUrl=${redirectUrl}
                        console.log('token ', token)
                        fetch(`http://localhost:8090/user/savePassword?token=${token}`, {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json'
                            },
                            body: JSON.stringify(requestData),
                        })
                            .then(response => {
                                window.location.href = "";
                            })
                            .catch(error => {
                                console.error('Error:', error);
                                // Handle errors here (e.g., show an error message to the user)
                            });
                    });
                }
            }

            function main() {
                const token = getTokenFromUrl();
                if (token) {
                    sendTokenToServer(token);
                } else {
                    console.error('Token not found in URL');
                    // Handle missing token scenario (e.g., show an error message to the user)
                }
            }

            // Execute main function when the page loads
            window.onload = main;
        });
    </script>
</body>
</html>